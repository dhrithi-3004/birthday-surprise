<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Happy Birthday!</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* The Terminal Intro Screen */
        #terminal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f0; /* Hacker green text */
            z-index: 10;
            background: black;
            flex-direction: column;
            pointer-events: none; /* Allows clicking through if hidden, just in case */
        }
        
        /* The 3D Canvas */
        #canvas-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            opacity: 0; /* Hidden initially */
            transition: opacity 2s ease-in-out;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="terminal">
        <div id="typewriter"></div>
    </div>

    <div id="canvas-container"></div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // --- PART 1: THE TERMINAL INTRO ---
        const textToType = [
            "> waking up system...",
            "> loading memories...",
            "> today is your birthday...",
            "> so I made you this..."
        ];
        
        const typeWriterElement = document.getElementById('typewriter');
        let lineIndex = 0;
        let charIndex = 0;

        function typeWriter() {
            if (lineIndex < textToType.length) {
                if (charIndex < textToType[lineIndex].length) {
                    if(charIndex === 0) typeWriterElement.innerHTML += "<br>";
                    typeWriterElement.innerHTML += textToType[lineIndex].charAt(charIndex);
                    charIndex++;
                    setTimeout(typeWriter, 50); 
                } else {
                    lineIndex++;
                    charIndex = 0;
                    setTimeout(typeWriter, 1000); 
                }
            } else {
                // Fade out terminal
                setTimeout(() => {
                    const term = document.getElementById('terminal');
                    term.style.opacity = '0';
                    // Completely remove it after fade so it doesn't block clicks
                    setTimeout(() => term.style.display = 'none', 2000); 
                    
                    document.getElementById('canvas-container').style.opacity = '1';
                    init3DScene(); 
                }, 2000);
            }
        }
        
        typeWriter();


        // --- PART 2: THE 3D SCENE ---
        function init3DScene() {
            const container = document.getElementById('canvas-container');
            
            // 1. Setup Scene
            const scene = new THREE.Scene();
            
            // --- MODIFICATION A: BACKGROUND IMAGE ---
            // We use a texture loader to load the background image
            const textureLoader = new THREE.TextureLoader();
            
            // Load the background (Ensure 'background.jpg' is in your folder)
            textureLoader.load('background.jpg', function(texture) {
                scene.background = texture;
            }, undefined, function(err) {
                // Fallback to dark gray if image is missing
                console.log("Background image not found, using color.");
                scene.background = new THREE.Color(0x111111);
            });

            // 2. Camera
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 5); 

            // 3. Renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            // This helps GLB models look correct (handles colors better)
            renderer.outputColorSpace = THREE.SRGBColorSpace; 
            container.appendChild(renderer.domElement);

            // 4. Controls
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 1.0;

            // 5. Lighting (Important for 3D models!)
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5); // General brightness
            scene.add(ambientLight);
            
            const pointLight = new THREE.PointLight(0xffffff, 50);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            // --- MODIFICATION B: 3D MODEL LOADER ---
            const gltfLoader = new GLTFLoader();

            // Load the Cake (Ensure 'cake_model.glb' is in your folder)
            gltfLoader.load('cake_model.glb', function (gltf) {
                const model = gltf.scene;
                
                // Adjust these if your model is too big or too small
                model.scale.set(1, 1, 1); 
                model.position.set(0, -0.5, 0); // Lower it slightly so it sits nicely
                
                scene.add(model);
            }, undefined, function (error) {
                console.error("An error happened loading the model:", error);
                // If model fails, add a red cube just so you see something
                const geometry = new THREE.BoxGeometry();
                const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                const cube = new THREE.Mesh(geometry, material);
                scene.add(cube);
            });


            // --- MODIFICATION C: PHOTO FRAME WITH TEXTURE ---
            // Load your photo (Ensure 'photo.jpg' is in your folder)
            const photoTexture = textureLoader.load('photo.jpg');
            // Fix color encoding for the photo
            photoTexture.colorSpace = THREE.SRGBColorSpace; 

            const photoGeometry = new THREE.PlaneGeometry(2, 1.5); // Width: 2, Height: 1.5
            const photoMaterial = new THREE.MeshBasicMaterial({ 
                map: photoTexture, 
                side: THREE.DoubleSide 
            });
            
            const photoFrame = new THREE.Mesh(photoGeometry, photoMaterial);
            photoFrame.position.set(0, 2, 0); // Position it above the cake
            scene.add(photoFrame);

            // 6. Animation Loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update(); 
                
                // Floating animation for the photo
                if(photoFrame) {
                    photoFrame.position.y = 2 + Math.sin(Date.now() * 0.002) * 0.1;
                    // Make the photo always look at the camera (optional)
                    photoFrame.lookAt(camera.position);
                }
                
                renderer.render(scene, camera);
            }
            animate();

            // Resize handling
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>
</html>
